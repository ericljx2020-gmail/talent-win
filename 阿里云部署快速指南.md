# 阿里云部署快速指南

## 🚀 5分钟快速部署

### 准备工作

1. **购买阿里云ECS服务器**
   - 登录 https://ecs.console.aliyun.com
   - 推荐配置：1核2GB，Ubuntu 22.04
   - 记住：公网IP地址和登录密码

2. **配置安全组**
   - 开放端口：22, 80, 443, 8080

### 部署步骤

#### 第一步：连接到服务器

```bash
# 在本地终端执行（替换为你的ECS IP）
ssh root@your-ecs-ip

# 输入密码登录
```

#### 第二步：上传项目文件

**方法A：使用Git（推荐）**

```bash
# 在ECS服务器上执行
apt update
apt install git -y

# 克隆项目（如果已上传到GitHub）
git clone https://github.com/your-username/talent-win.git
cd talent-win
```

**方法B：使用SCP上传（如果没有Git仓库）**

```bash
# 在你的本地Mac电脑执行
cd /Users/eureka/Desktop/Projects/talent-win
tar -czf talent-win.tar.gz .

# 上传到ECS
scp talent-win.tar.gz root@your-ecs-ip:/root/

# 回到ECS服务器
ssh root@your-ecs-ip
mkdir talent-win && cd talent-win
tar -xzf ../talent-win.tar.gz
```

#### 第三步：运行部署脚本

```bash
# 在ECS服务器的项目目录执行
chmod +x deploy-aliyun.sh
./deploy-aliyun.sh

# 选择选项1（首次部署）
```

脚本会自动：
- ✅ 安装Docker和Docker Compose
- ✅ 配置阿里云镜像加速
- ✅ 构建并启动应用
- ✅ 显示访问地址

#### 第四步：访问网站

```
http://your-ecs-ip:8080
```

## 📝 常用命令

```bash
# 查看运行状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose down

# 更新部署
./deploy-aliyun.sh
# 选择选项2

# 查看公网IP
curl ifconfig.me
```

## 🔧 配置域名（可选）

### 1. 在阿里云添加域名解析

1. 登录阿里云控制台
2. 域名 → 域名列表 → 解析
3. 添加记录：
   - 记录类型：A
   - 主机记录：@ 或 www
   - 记录值：你的ECS公网IP
   - TTL：10分钟

### 2. 修改端口为80

编辑 `docker-compose.yml`：

```yaml
ports:
  - "80:80"  # 改为80端口
```

重新部署：

```bash
docker-compose down
docker-compose up -d
```

### 3. 配置HTTPS（可选）

```bash
# 安装Certbot
apt install certbot python3-certbot-nginx -y

# 获取SSL证书
certbot certonly --standalone -d your-domain.com

# 证书会保存在 /etc/letsencrypt/live/your-domain.com/
```

## 💰 成本估算

**最低配置（测试/个人网站）**
- ECS：1核2GB = ¥70/月
- 带宽：1Mbps = ¥23/月
- **总计：约¥93/月**

**推荐配置（小型企业）**
- ECS：2核4GB = ¥140/月
- 带宽：5Mbps = ¥115/月
- **总计：约¥255/月**

💡 提示：
- 使用包年包月可享折扣
- 新用户有优惠活动
- 抢占式实例更便宜（不保证稳定）

## 🛠️ 常见问题

### Docker镜像拉取失败？

如果遇到以下错误：
```
failed to solve: nginx:alpine: pull access denied, repository does not exist or may require authorization
```

**原因：** 从中国大陆访问 Docker Hub 受限

**解决方案：**

```bash
# 1. 配置多个Docker镜像加速器
sudo tee /etc/docker/daemon.json > /dev/null <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://docker.nju.edu.cn",
    "https://hub.rat.dev",
    "https://registry.cn-hangzhou.aliyuncs.com",
    "https://docker.mirrors.ustc.edu.cn",
    "https://dockerproxy.com"
  ]
}
EOF

# 2. 重启Docker服务
sudo systemctl daemon-reload
sudo systemctl restart docker

# 3. 验证配置是否生效
docker info | grep -A 10 "Registry Mirrors"

# 4. 重新部署
./deploy-aliyun.sh
# 选择选项1
```

### 无法访问网站？

1. **检查安全组规则**
   - 阿里云控制台 → ECS → 安全组
   - 确保8080端口已开放

2. **检查容器状态**
   ```bash
   docker-compose ps
   # 应该显示 Up 状态
   ```

3. **查看日志**
   ```bash
   docker-compose logs
   ```

### 端口被占用？

```bash
# 查看占用端口的进程
netstat -tunlp | grep 8080

# 停止占用端口的进程
kill -9 [进程ID]
```

### 内存不足？

```bash
# 查看内存使用
free -h

# 清理Docker占用
docker system prune -a
```

### 更新代码后如何重新部署？

**推荐流程（使用Git）：**

```bash
# 1. 在本地Mac修改代码后提交
cd /Users/eureka/Desktop/Projects/talent-win
git add .
git commit -m "更新说明"
git push origin main

# 2. SSH登录到服务器
ssh root@8.153.166.197

# 3. 更新部署
cd /root/talent-win
./deploy-aliyun.sh
# 选择选项2（更新部署）

# 4. 验证更新
docker-compose ps
docker-compose logs -f --tail=50
# 访问：http://8.153.166.197:8080
```

**手动执行：**
```bash
cd /root/talent-win
git pull origin main
docker-compose down
docker-compose up -d --build
docker image prune -f
```

**📖 详细流程请参考：`更新部署流程.md`**

## 📊 性能优化

### 1. 启用CDN加速

- 阿里云CDN控制台
- 添加你的域名
- 源站填写ECS IP
- 配置缓存规则

### 2. 配置监控告警

- 云监控 → 主机监控
- 添加告警规则（CPU > 80%、内存 > 90%等）

### 3. 定期备份

```bash
# 创建备份脚本
cat > backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d)
tar -czf backup-$DATE.tar.gz /root/talent-win
# 可以上传到阿里云OSS
EOF

chmod +x backup.sh

# 添加定时任务
crontab -e
# 添加：0 2 * * * /root/backup.sh
```

## 🔐 安全建议

1. **修改SSH默认端口**
2. **配置防火墙规则**
3. **定期更新系统**
   ```bash
   apt update && apt upgrade -y
   ```
4. **使用密钥登录代替密码**
5. **配置HTTPS证书**

## 📞 获取帮助

- 阿里云文档中心：https://help.aliyun.com
- ECS产品文档：https://help.aliyun.com/product/25365.html
- 工单系统：阿里云控制台 → 工单

## 📚 下一步

1. ✅ 部署成功后，配置EmailJS（参考 `EMAILJS_SETUP.md`）
2. ✅ 绑定域名并配置SSL
3. ✅ 设置CDN加速
4. ✅ 配置监控和备份
5. ✅ 优化网站内容和图片

---

**快速命令参考**

```bash
# 部署
./deploy-aliyun.sh

# 查看状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 重启
docker-compose restart

# 停止
docker-compose down

# 查看IP
curl ifconfig.me
```

祝部署顺利！🎉

